<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#081225" />
  <link rel="manifest" href="manifest.json" />
  <title>Typer</title>

  <!-- AUTO-FIX CACHE: jeśli wykryje inną wersję, spróbuje wyczyścić SW/cache -->
  <script>
    (async () => {
      const BUILD = "1006";
      try {
        const last = localStorage.getItem("typer_last_build");
        if (last !== BUILD) {
          localStorage.setItem("typer_last_build", BUILD);
          if ("serviceWorker" in navigator) {
            const regs = await navigator.serviceWorker.getRegistrations();
            await Promise.all(regs.map(r => r.unregister()));
          }
          if (window.caches) {
            const keys = await caches.keys();
            await Promise.all(keys.map(k => caches.delete(k)));
          }
        }
      } catch (e) {}
    })();
  </script>

  <style>
    :root{
      --bg:#071022;
      --text:#e9eef9;
      --stroke:rgba(255,255,255,.10);
      --glass:rgba(8,18,34,.52);
      --glass2:rgba(8,18,34,.38);
      --shadow:0 10px 28px rgba(0,0,0,.33);
      --accent: rgba(25, 95, 140, .45);
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
    body{ overflow:hidden; }

    .screen{ position:fixed; inset:0; background:var(--bg); }
    .bg{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover; object-position:center;
      transform: scale(1.01);
      user-select:none; -webkit-user-drag:none;
    }

    .topbar{
      position:absolute;
      top: calc(env(safe-area-inset-top) + 8px);
      left: 50%;
      transform: translateX(-50%);
      width: min(900px, calc(100% - 18px));
      display:flex; align-items:center; justify-content:space-between;
      gap:8px;
      padding: 6px 8px;
      border-radius: 12px;
      background: var(--glass);
      border: 1px solid var(--stroke);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      z-index: 10;
    }
    .top-left{ display:flex; align-items:baseline; gap:10px; min-width:0; }
    .title{ font-weight:900; font-size:14px; letter-spacing:.2px; white-space:nowrap; }
    .nick{
      display:flex; align-items:center; gap:6px;
      padding: 5px 8px;
      border-radius: 12px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      max-width: 52vw; min-width: 120px;
    }
    .nick-label{ font-size:11px; color: rgba(233,238,249,.80); white-space:nowrap; }
    .nick-value{ font-size:14px; font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .top-right{ display:flex; align-items:center; gap:8px; flex-shrink:0; }
    .btnSmall{
      appearance:none;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 7px 10px;
      border-radius: 12px;
      font-weight: 850;
      font-size: 12px;
      cursor:pointer;
      backdrop-filter: blur(10px);
      white-space:nowrap;
    }
    .btnSmall:active{ transform: translateY(1px); }

    .center{
      position:absolute; left:0; right:0;
      top:50%;
      transform: translateY(-28%);
      display:flex; flex-direction:column;
      align-items:center; gap:16px;
      padding:0 14px;
      z-index: 5;
    }
    .btnBig{
      width: min(760px, 86%);
      height: 60px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: var(--accent);
      color: #fff;
      font-weight: 900;
      font-size: 18px;
      cursor:pointer;
      box-shadow: 0 14px 34px rgba(0,0,0,.32);
      backdrop-filter: blur(10px);
    }
    .btnBig:nth-child(2){ background: rgba(55,95,120,.42); }
    .btnBig:nth-child(3){ background: rgba(80,110,60,.38); }
    .btnBig:active{ transform: translateY(1px); }

    .bottombar{
      position:absolute; left: 50%; transform: translateX(-50%);
      width: min(900px, calc(100% - 18px));
      bottom: calc(env(safe-area-inset-bottom) + 10px);
      padding: 7px 10px;
      border-radius: 12px;
      background: var(--glass2);
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      font-size: 11px;
      color: rgba(233,238,249,.78);
      z-index: 10;
    }
    .bottom-left{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .bottom-right{ display:flex; align-items:center; gap:8px; flex-shrink:0; }
    .btnTiny{
      appearance:none;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(233,238,249,.90);
      padding: 6px 9px;
      border-radius: 12px;
      font-weight: 850;
      font-size: 11px;
      cursor:pointer;
      white-space:nowrap;
    }

    /* Splash */
    .splash{
      position:fixed; inset:0; z-index:9999;
      background:#071022;
      display:flex; align-items:center; justify-content:center;
      flex-direction:column; gap:14px;
    }
    .splash img{
      width: min(560px, 84vw);
      max-height: 64vh;
      height:auto;
      border-radius: 18px;
      box-shadow: 0 22px 70px rgba(0,0,0,.48);
      object-fit: cover;
    }
    .splash .hint{
      font-size:13px;
      color: rgba(233,238,249,.78);
      padding: 8px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
    }

    /* Room */
    .roomWrap{
      position:absolute;
      left: 50%; transform: translateX(-50%);
      top: calc(env(safe-area-inset-top) + 64px);
      width: min(980px, calc(100% - 18px));
      bottom: calc(env(safe-area-inset-bottom) + 64px);
      display:grid;
      grid-template-columns: 1fr 340px;
      gap: 12px;
      z-index: 6;
    }
    @media (max-width: 820px){ .roomWrap{ grid-template-columns: 1fr; } }
    .panel{
      border-radius: 16px;
      background: rgba(8,18,34,.52);
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 34px rgba(0,0,0,.25);
      padding: 12px;
      overflow: hidden;
    }
    .panelTitle{ font-weight: 900; font-size: 13px; color: rgba(233,238,249,.92); margin-bottom: 8px; }
    .roomName{ font-weight: 950; font-size: 18px; margin-bottom: 6px; line-height: 1.15; }
    .adminLine{ font-size: 12px; color: rgba(233,238,249,.82); margin-bottom: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .codeBox{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding: 10px 10px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      margin-bottom: 10px;
    }
    .codeText{ font-weight: 950; font-size: 18px; letter-spacing: 2px; white-space: nowrap; }
    .playersList{ display:flex; flex-direction:column; gap:8px; overflow:auto; max-height: 100%; padding-right: 4px; }
    .playerRow{
      padding: 10px 10px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      display:flex;
      gap:8px;
      align-items:baseline;
    }
    .playerLabel{ font-size: 12px; color: rgba(233,238,249,.78); white-space: nowrap; }
    .playerName{ font-weight: 900; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .panelBtns{ display:flex; gap:8px; flex-wrap: wrap; }
    .btnPanel{
      appearance:none;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(233,238,249,.92);
      padding: 8px 10px;
      border-radius: 12px;
      font-weight: 900;
      font-size: 12px;
      cursor:pointer;
      white-space: nowrap;
    }
    .btnDanger{ background: rgba(170,60,60,.20); border-color: rgba(255,120,120,.22); }

    /* Fixtures */
    .fixturesWrap{
      position:absolute;
      left: 50%; transform: translateX(-50%);
      top: calc(env(safe-area-inset-top) + 64px);
      width: min(980px, calc(100% - 18px));
      bottom: calc(env(safe-area-inset-bottom) + 64px);
      display:grid;
      grid-template-columns: 1fr 340px;
      gap: 12px;
      z-index: 6;
    }
    @media (max-width: 820px){ .fixturesWrap{ grid-template-columns: 1fr; } }
    .fixtureList{ display:flex; flex-direction:column; gap:8px; overflow:auto; max-height: 100%; padding-right: 4px; }
    .fixtureRow{
      padding: 10px 10px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .fxTop{ display:flex; justify-content:space-between; gap:10px; align-items:baseline; font-size: 12px; color: rgba(233,238,249,.76); }
    .fxTeams{ font-weight: 950; font-size: 14px; line-height: 1.15; display:flex; justify-content:space-between; gap:10px; }
    .fxTeams span{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .fxVs{ flex:0 0 auto; opacity:.8; }
    .hintSmall{ font-size: 12px; color: rgba(233,238,249,.78); line-height: 1.35; }

    /* Modal */
    .modalMask{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center; justify-content:center;
      z-index: 20000;
      padding: 16px;
    }
    .modal{
      width: min(520px, 100%);
      border-radius: 18px;
      background: rgba(10,18,34,.92);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
      padding: 14px;
    }
    .modal h3{ margin: 0 0 8px 0; font-size: 16px; font-weight: 950; }
    .modal p{ margin: 0 0 10px 0; font-size: 12px; color: rgba(233,238,249,.76); }
    .row{ display:flex; gap:10px; align-items:center; }
    input{
      flex:1;
      height: 44px;
      padding: 0 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-size: 16px;
      outline: none;
    }
    .modalBtn{
      height: 44px;
      padding: 0 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.14);
      color: var(--text);
      cursor:pointer;
      font-weight: 950;
      white-space: nowrap;
    }
    .modalBtnSecondary{ background: rgba(255,255,255,.06); }
    .modalBtn:active{ transform: translateY(1px); }

    .hidden{ display:none !important; }
  </style>
</head>

<body>
  <!-- Splash 7s -->
  <div id="splash" class="splash">
    <img src="img_starter.png" alt="Start" />
    <div id="splashHint" class="hint">Ekran startowy (7s)…</div>
  </div>

  <!-- MENU -->
  <div class="screen" id="menuScreen">
    <img class="bg" id="menuImg" alt="Menu" />
    <div class="topbar">
      <div class="top-left">
        <div class="title">Menu</div>
        <div class="nick"><div class="nick-label">Nick:</div><div class="nick-value" id="nickText">—</div></div>
      </div>
      <div class="top-right"><button class="btnSmall" id="changeNickBtn">Zmień nick</button></div>
    </div>
    <div class="center">
      <button class="btnBig" id="btnLiga">Liga typerów</button>
      <button class="btnBig" id="btnStats">Statystyki</button>
      <button class="btnBig" id="btnExit">Wyjście</button>
    </div>
    <div class="bottombar">
      <div class="bottom-left">Copyright 2026 RN_APS Mariusz Gębka • BUILD 1006</div>
      <div class="bottom-right"><button class="btnTiny" id="btnRefresh">Odśwież / napraw</button></div>
    </div>
  </div>

  <!-- ROOMS -->
  <div class="screen hidden" id="roomsScreen">
    <img class="bg" id="roomsBg" alt="Pokoje" />
    <div class="topbar">
      <div class="top-left">
        <div class="title">Pokoje</div>
        <div class="nick"><div class="nick-label">Nick:</div><div class="nick-value" id="nickTextRooms">—</div></div>
      </div>
      <div class="top-right"><button class="btnSmall" id="backToMenuBtn">Wróć</button></div>
    </div>
    <div class="center">
      <button class="btnBig" id="btnNewRoom">Nowy pokój</button>
      <button class="btnBig" id="btnJoinRoom">Dołącz do pokoju</button>
    </div>
    <div class="bottombar">
      <div class="bottom-left">Copyright 2026 RN_APS Mariusz Gębka • BUILD 1006</div>
      <div class="bottom-right"><button class="btnTiny" id="btnRefresh2">Odśwież / napraw</button></div>
    </div>
  </div>

  <!-- ROOM -->
  <div class="screen hidden" id="roomScreen">
    <img class="bg" id="roomBg" alt="Pokój" />
    <div class="topbar">
      <div class="top-left">
        <div class="title">Pokój</div>
        <div class="nick"><div class="nick-label">Nick:</div><div class="nick-value" id="nickTextRoom">—</div></div>
      </div>
      <div class="top-right"><button class="btnSmall" id="backToRoomsBtn">Wróć</button></div>
    </div>

    <div class="roomWrap">
      <div class="panel">
        <div class="panelTitle">Gracze</div>
        <div id="playersList" class="playersList"></div>
      </div>

      <div class="panel">
        <div class="panelTitle">Informacje</div>
        <div id="roomName" class="roomName">—</div>
        <div id="roomAdmin" class="adminLine">Admin: —</div>

        <div class="codeBox">
          <div>
            <div style="font-size:11px;color:rgba(233,238,249,.72);margin-bottom:4px;">Kod pokoju</div>
            <div id="roomCode" class="codeText">------</div>
          </div>
          <button class="btnPanel" id="btnCopyCode">Kopiuj</button>
        </div>

        <div class="panelBtns">
          <button class="btnPanel" id="btnFixtures">Mecze tygodnia (TEST)</button>
          <button class="btnPanel btnDanger" id="btnLeaveRoom">Opuść pokój</button>
        </div>

        <div class="hintSmall" id="roomDebug" style="margin-top:10px;opacity:.85;"></div>
      </div>
    </div>

    <div class="bottombar">
      <div class="bottom-left">Copyright 2026 RN_APS Mariusz Gębka • BUILD 1006</div>
      <div class="bottom-right"><button class="btnTiny" id="btnRefresh3">Odśwież / napraw</button></div>
    </div>
  </div>

  <!-- FIXTURES -->
  <div class="screen hidden" id="fixturesScreen">
    <img class="bg" id="fixturesBg" alt="Mecze" />
    <div class="topbar">
      <div class="top-left">
        <div class="title">Mecze tygodnia</div>
        <div class="nick"><div class="nick-label">Pokój:</div><div class="nick-value" id="fixturesRoomLabel">—</div></div>
      </div>
      <div class="top-right"><button class="btnSmall" id="backToRoomBtn">Wróć</button></div>
    </div>

    <div class="fixturesWrap">
      <div class="panel">
        <div class="panelTitle" id="fixturesTitle">Ekstraklasa — test</div>
        <div id="fixturesList" class="fixtureList"></div>
      </div>

      <div class="panel">
        <div class="panelTitle">Sterowanie</div>
        <div class="hintSmall" id="fixturesInfo">Kliknij „Pobierz / odśwież”.</div>
        <div style="height:10px;"></div>
        <div class="panelBtns">
          <button class="btnPanel" id="btnLoadFixtures">Pobierz / odśwież</button>
          <button class="btnPanel" id="btnClearFixtures">Wyczyść kolejkę</button>
        </div>
      </div>
    </div>

    <div class="bottombar">
      <div class="bottom-left">Copyright 2026 RN_APS Mariusz Gębka • BUILD 1006</div>
      <div class="bottom-right"><button class="btnTiny" id="btnRefresh4">Odśwież / napraw</button></div>
    </div>
  </div>

  <!-- MODAL: Create room -->
  <div id="createRoomMask" class="modalMask">
    <div class="modal">
      <h3>Nowy pokój</h3>
      <p>Podaj nazwę pokoju. Wygenerujemy kod 6 znaków.</p>
      <div class="row">
        <input id="createRoomNameInput" type="text" maxlength="24" placeholder="np. Liga Mariusza" />
        <button id="createRoomOkBtn" class="modalBtn">Utwórz</button>
      </div>
      <div class="row" style="margin-top:10px;justify-content:flex-end;">
        <button id="createRoomCancelBtn" class="modalBtn modalBtnSecondary">Anuluj</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Join room -->
  <div id="joinRoomMask" class="modalMask">
    <div class="modal">
      <h3>Dołącz do pokoju</h3>
      <p>Wpisz kod pokoju (6 znaków), a potem kliknij Dołącz.</p>
      <div class="row">
        <input id="joinRoomCodeInput" type="text" maxlength="6" placeholder="np. A7K9Q2" />
        <button id="joinRoomOkBtn" class="modalBtn">Dołącz</button>
      </div>
      <div class="row" style="margin-top:10px;justify-content:flex-end;">
        <button id="joinRoomCancelBtn" class="modalBtn modalBtnSecondary">Anuluj</button>
      </div>
    </div>
  </div>

  <script src="app.js?v=1006"></script>
</body>
</html>
